<!doctype html>
<html lang="el">
<head>
  <meta charset="utf-8" />
  <title>Πίνακας Φοιτητή/τριας</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- ΣΩΣΤΟ PATH ΓΙΑ CSS -->
  <link rel="stylesheet" href="./css/styles.css?v=3">
</head>

<body class="student">
  <!-- Topbar -->
  <header class="topbar">
    <h2>Πίνακας Φοιτητή/τριας</h2>
    <button id="logoutBtn" class="btn danger">Αποσύνδεση</button>
  </header>

  <!-- Tabs -->
  <nav class="tabs">
    <button type="button" data-tab="view"    id="tab-view"    class="active">1) Προβολή θέματος</button>
    <button type="button" data-tab="profile" id="tab-profile">2) Επεξεργασία προφίλ</button>
    <button type="button" data-tab="manage"  id="tab-manage">3) Διαχείριση διπλωματικής</button>
  </nav>

  <!-- 1) ΠΡΟΒΟΛΗ ΘΕΜΑΤΟΣ -->
  <section id="pane-view" class="card">
    <section id="thesis">Φόρτωση στοιχείων διπλωματικής…</section>
  </section>

  <!-- 2) ΕΠΕΞΕΡΓΑΣΙΑ ΠΡΟΦΙΛ -->
  <section id="pane-profile" class="card" hidden>
    <h3 style="margin-top:0">Επεξεργασία Προφίλ</h3>
    <form id="profileForm" class="row" style="gap:.6rem; max-width:720px">
      <label class="field">
        <span>Email επικοινωνίας</span>
        <input type="email" name="email" required />
      </label>
      <label class="field">
        <span>Κινητό</span>
        <input type="text" name="phone_mobile" placeholder="+30 69..." />
      </label>
      <label class="field">
        <span>Σταθερό</span>
        <input type="text" name="phone_landline" placeholder="+30 2610..." />
      </label>
      <label class="field" style="grid-column:1/-1">
        <span>Πλήρης ταχυδρομική διεύθυνση</span>
        <textarea name="address" rows="3" placeholder="Οδός, αριθμός, ΤΚ, πόλη"></textarea>
      </label>
      <div style="display:flex; gap:.6rem; align-items:center">
        <button type="submit" class="btn">Αποθήκευση</button>
        <span id="profileMsg" class="form-msg"></span>
      </div>
    </form>
  </section>

  <!-- 3) ΔΙΑΧΕΙΡΙΣΗ ΔΙΠΛΩΜΑΤΙΚΗΣ -->
  <section id="pane-manage" class="card" hidden>

    <!-- ΥΠΟ ΑΝΑΘΕΣΗ — Επιλογή μελών -->
    <section class="card">
      <h3 style="margin-top:0">Υπό ανάθεση — Επιλογή μελών τριμελούς</h3>

      <!-- Αναζήτηση διδασκόντων -->
      <form id="teacherSearchF" class="row" style="align-items:end">
        <label style="grid-column:1/-1">
          <span>Αναζήτηση διδασκόντων (όνομα ή email)</span>
          <input name="q" placeholder="π.χ. Γάμμα ή gamma@uni.gr" />
        </label>
        <button class="btn" type="submit">Αναζήτηση</button>
        <span id="teacherSearchMsg" class="muted"></span>
      </form>

      <!-- Αποτελέσματα -->
      <div id="teacherResults" class="card" style="padding:.6rem"></div>

      <!-- Γρήγορη πρόσκληση -->
      <form id="inviteF" class="card" style="padding:12px;margin-top:.6rem">
        <label>person_id (UUID από persons)
          <input name="person_id" placeholder="π.χ. 2b0b3e24-...." />
        </label>
        <button class="btn" type="submit">Αποστολή πρόσκλησης</button>
        <div id="inviteMsg" class="muted" style="margin-top:.5rem"></div>
        <small class="muted">Μόλις 2 μέλη αποδεχθούν, η ΔΕ γίνεται «Ενεργή» αυτόματα (trigger).</small>
      </form>
    </section>

    <!-- ΥΠΟ ΕΞΕΤΑΣΗ — Υλικό -->
    <section class="card">
      <h3 style="margin-top:0">Υπό εξέταση — Ανάρτηση υλικού</h3>

      <!-- Upload draft ως αρχείο -->
      <form id="draftUploadF" class="row">
        <label style="grid-column:1/-1">
          <span>Αρχείο πρόχειρου κειμένου (PDF/ZIP/DOCX)</span>
          <input type="file" name="file" />
        </label>
        <div style="grid-column:1/-1;display:flex;gap:.6rem;align-items:center">
          <button class="btn" type="submit">Μεταφόρτωση</button>
          <span id="draftUploadMsg" class="muted"></span>
        </div>
      </form>

      <!-- Λίστα ανεβασμένων drafts -->
      <div id="draftList" class="card" style="margin-top:.6rem; padding:.6rem"></div>

      <!-- Καταχώρηση πόρου ως link -->
      <form id="resourceF" class="row" style="margin-top:.6rem">
        <label>
          <span>Είδος</span>
          <select name="kind">
            <option value="draft">Πρόχειρο κείμενο (draft)</option>
            <option value="code">Κώδικας</option>
            <option value="video">Βίντεο</option>
            <option value="image">Εικόνα</option>
            <option value="other">Άλλο</option>
          </select>
        </label>
        <label>
          <span>Σύνδεσμος (URL)</span>
          <input name="url_or_path" placeholder="https://drive.google.com/..." />
        </label>
        <div style="grid-column:1/-1;display:flex;gap:.6rem;align-items:center">
          <button class="btn" type="submit">Καταχώρηση</button>
          <span id="resourceMsg" class="muted"></span>
        </div>
      </form>
    </section>

    <!-- ΥΠΟ ΕΞΕΤΑΣΗ — Παρουσίαση -->
    <section class="card">
      <h3 style="margin-top:0">Υπό εξέταση — Ημερομηνία παρουσίασης</h3>
      <form id="scheduleF" class="row">
        <label>
          <span>Ημ/νία & ώρα</span>
          <input type="datetime-local" name="when_dt" />
        </label>
        <label>
          <span>Τρόπος</span>
          <select name="mode">
            <option value="in_person">Δια ζώσης</option>
            <option value="online">Online</option>
          </select>
        </label>
        <label style="grid-column:1/-1">
          <span>Αίθουσα ή σύνδεσμος</span>
          <input name="room_or_link" placeholder="π.χ. ΒΜΕ-Αμφιθ. ή https://..." />
        </label>
        <div style="grid-column:1/-1;display:flex;gap:.6rem;align-items:center">
          <button class="btn" type="submit">Καταχώρηση</button>
          <span id="scheduleMsg" class="muted"></span>
        </div>
        <small class="muted" style="grid-column:1/-1">Οι κανόνες 21–60 ημερών + ≥7 ημέρες προαναγγελίας ελέγχονται από triggers.</small>
      </form>
    </section>

    <!-- ΜΕΤΑ ΤΟΥΣ ΒΑΘΜΟΥΣ — Νημερτής -->
    <section class="card">
      <h3 style="margin-top:0">Μετά τους βαθμούς — Νημερτής</h3>
      <form id="nimeritisF" class="row">
        <label style="grid-column:1/-1">
          <span>Σύνδεσμος Νημερτής (τελικό κείμενο)</span>
          <input name="nimeritis_url" placeholder="http://..." />
        </label>
        <label>
          <span>Ημ/νία κατάθεσης</span>
          <input type="date" name="nimeritis_deposit_date" />
        </label>
        <div style="grid-column:1/-1;display:flex;gap:.6rem;align-items:center">
          <button class="btn" type="submit">Αποθήκευση</button>
          <span id="nimeritisMsg" class="muted"></span>
        </div>
      </form>
    </section>

    <!-- Boxes που γεμίζει το student.js -->
    <div id="invitesBox" class="card"></div>
    <div id="membersBox" class="card"></div>
    <div id="timelineBox" class="card"></div>
    <div id="gradesBox" class="card"></div>
    <div id="presentationBox" class="card"></div>
  </section>

  <!-- Tabs wiring -->
  <script type="module">
    const panes = {
      view:    document.getElementById('pane-view'),
      profile: document.getElementById('pane-profile'),
      manage:  document.getElementById('pane-manage'),
    };
    const tabs = {
      view:    document.getElementById('tab-view'),
      profile: document.getElementById('tab-profile'),
      manage:  document.getElementById('tab-manage'),
    };
    function show(name){
      Object.entries(panes).forEach(([k,el]) => el.hidden = (k!==name));
      Object.entries(tabs).forEach(([k,btn]) => btn.classList.toggle('active', k===name));
    }
    Object.values(tabs).forEach(btn=>btn.addEventListener('click', ()=> show(btn.dataset.tab)));
    show('view'); // default
  </script>

  <!-- Modules -->
  <script type="module">
    import { logout } from './js/auth.js';
    document.getElementById('logoutBtn').addEventListener('click', logout);
  </script>
  <script type="module" src="./js/student.js?v=5"></script>
</body>
</html>
